{{!< layout}}

<main id="main" class="main">
    <div class="main-inner">
        <div class="content-wrap">
            <div id="content" class="content">
                <section id="posts" class="posts-expand">
                    {{#foreach posts}}
                        <article class="post-excerpt {{post_class}}">
                            <header class="post-header">
                                <h1 class="post-title" itemprop="name headline">
                                    <a class="post-title-link" href="{{url}}">{{title}}</a>
                                </h1>
                                <div class="post-meta">
                                    <span class="post-time">
                                        <span class="post-meta-item-text">由</span>
                                        {{author}}
                                        <span class="post-meta-item-text">发表于</span>
                                        <time datetime="{{date format="YYYY-MM-DD"}}">{{date format="YYYY-MM-DD"}}</time>
                                    </span>
                                </div>
                            </header>
                            <div class="post-body">
                                {{content}}
                                <div class="post-more-link text-center">
                                    <a class="btn" href="{{url}}">阅读全文 »</a>
                                </div>
                            </div>
                            <footer class="post-footer">
                                <div class="post-eof"></div>
                            </footer>
                        </article>
                    {{/foreach}}
                    <script>
                        var contents = document.querySelectorAll('.kg-card-markdown');
                        for (var i = 0; i < contents.length; ++i) {
                            var nodes = contents[i].querySelectorAll('.kg-card-markdown > *');
                            if (nodes.length <= 5) {
                                contents[i].parentElement.querySelector('.post-more-link').style.display = 'none';
                                continue;
                            }

                            var more = Array.from(nodes).slice(5);
                            for (var j = 0; j < more.length; ++j) {
                                contents[i].removeChild(more[j]);
                            }

                            var h = /^[Hh][1-6]$/;
                            if (h.test(nodes[4].tagName) && !h.test(nodes[3].tagName)) {
                                contents[i].removeChild(nodes[4]);
                            }
                        }
                    </script>
                </section>

                {{pagination}}
            </div>
        </div>
    </div>
</main>
